# =====================================================
# Docker Compose for GitHub Issue Assistant
# Seedling Labs Engineering Craft Case
# =====================================================
#
# Usage:
#   1. Copy .env.example to .env and add your GEMINI_API_KEY
#   2. Run: docker-compose up --build
#   3. Open http://localhost:5173 in your browser
#
# Services:
#   - frontend: React app with Vite (port 5173)
#   - backend: FastAPI server (port 8000)
# =====================================================

services:
  # ===================
  # Backend Service
  # ===================
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: issue-assistant-backend
    ports:
      - "8000:8000"
    volumes:
      # Mount source code for hot reloading
      - ./backend/app:/app/app
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - HUGGINGFACE_API_KEY=${HUGGINGFACE_API_KEY}
      - GITHUB_TOKEN=${GITHUB_TOKEN:-}
      - CORS_ORIGINS=http://localhost:5173,http://127.0.0.1:5173
    env_file:
      - .env
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped
    networks:
      - app-network

  # ===================
  # Frontend Service
  # ===================
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: issue-assistant-frontend
    ports:
      - "5173:5173"
    volumes:
      # Mount source code for hot reloading
      - ./frontend/src:/app/src
    environment:
      - VITE_API_URL=http://localhost:8000
    depends_on:
      backend:
        condition: service_healthy
    restart: unless-stopped
    networks:
      - app-network

# ===================
# Networks
# ===================
networks:
  app-network:
    driver: bridge
